<main class="pet-profile">
  <header class="topbar">
    <button type="button" aria-label="Back" (click)="onBack()">&#8592;</button>
    <h1>Pet Profile</h1>
    <a
      class="top-link-btn"
      [routerLink]="pet() ? ['/pet-edit', pet()!.id] : ['/pets']"
      aria-label="Edit"
      >✎</a
    >
  </header>

  @if (loading()) {
    <section class="content">
      <div class="state-card">Ladowanie profilu zwierzaka...</div>
    </section>
  } @else if (loadError()) {
    <section class="content">
      <div class="state-card error">Nie udalo sie zaladowac profilu. Sprobuj ponownie.</div>
    </section>
  } @else if (pet(); as pet) {
    <section class="content">
      <article class="hero">
        <div class="avatar-wrap">
          @if (photoSrc(); as src) {
            <img [src]="src" [alt]="pet.name" />
          } @else {
            <div class="avatar-placeholder">{{ pet.name.slice(0, 1).toUpperCase() }}</div>
          }
          <span class="badge">✓</span>
        </div>
        <h2>{{ pet.name }}</h2>
        <p>{{ pet.breed.name }}</p>
        <div class="chips">
          <span>{{ ageLabel() }}</span>
          <span>{{ genderLabel() }}</span>
        </div>
      </article>

      <article class="card">
        <div class="card-title">
          <h3>Device Status</h3>
          <span
            class="freshness-badge"
            [class]="attributesFreshnessClass()"
            [title]="attributesFreshnessTooltip()"
          >
            {{ attributesFreshnessText() }}
          </span>
        </div>

        <div class="progress">
          <p>Battery <b>{{ batteryLabel() }}</b></p>
          <div>
            <span [style.width.%]="deviceInfo()?.batteryPercent ?? 0"></span>
          </div>
        </div>

        <div class="rows">
          <div class="row">
            <div>
              <strong>Tracker</strong>
              <p>{{ deviceDisplayName() }}</p>
            </div>
            <span class="mono">{{ deviceBusinessId() }}</span>
          </div>

          <div class="row">
            <div>
              <strong>Connectivity</strong>
              <p>
                {{ deviceInfo()?.connectivityStatus || 'NO_DEVICE' }} /
                {{ deviceInfo()?.locationStatus || 'NO_POSITION' }}
              </p>
            </div>
            <span class="value">{{
              deviceInfo()?.sensorLive || deviceInfo()?.locationLive ? 'LIVE' : 'OFFLINE'
            }}</span>
          </div>

          <div class="row">
            <div>
              <strong>Charging</strong>
              <p>{{ chargingLabel() }}</p>
            </div>
            <span class="value">{{ liveTrackingEnabled() ? 'Tracking ON' : 'Tracking OFF' }}</span>
          </div>

          <div class="row">
            <div>
              <strong>Last Location</strong>
              <p>{{ locationLabel() }}</p>
            </div>
            <span class="mono">{{ speedLabel() }}</span>
          </div>
        </div>
      </article>

      <article class="health">
        <h3>Health &amp; Safety</h3>
        <div class="health-grid">
          <button type="button">Safe Zones</button>
          <button type="button">Medical</button>
          <button type="button">Vaccines</button>
        </div>
        <p class="mock-note">Mock section for now (no backend contracts wired yet).</p>
      </article>

      <article class="card">
        <h3>Telemetry Snapshot</h3>
        <div class="rows">
          <div class="row">
            <div>
              <strong>Motion</strong>
              <p>Sensor movement flag</p>
            </div>
            <span class="value">{{ deviceInfo()?.motion == null ? 'N/A' : (deviceInfo()?.motion ? 'YES' : 'NO') }}</span>
          </div>
          <div class="row">
            <div>
              <strong>Sat / RSSI</strong>
              <p>Signal and satellites</p>
            </div>
            <span class="mono">{{ deviceInfo()?.sat ?? 'N/A' }} / {{ deviceInfo()?.rssi ?? 'N/A' }}</span>
          </div>
          <div class="row">
            <div>
              <strong>Distance</strong>
              <p>Session / total</p>
            </div>
            <span class="mono">{{ deviceInfo()?.distance ?? 'N/A' }} / {{ deviceInfo()?.totalDistance ?? 'N/A' }}</span>
          </div>
        </div>
      </article>

      <a class="edit-btn" [routerLink]="['/pet-edit', pet.id]">Edit Profile</a>
    </section>
  }

  <nav class="bottom-nav">
    <a routerLink="/main-view-map">Map</a>
    <a routerLink="/pets">Pets</a>
    <a routerLink="/pets">Activity</a>
    <a routerLink="/pets" class="active">Profile</a>
  </nav>
</main>
